<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุชุฑุฌู ุฒููุณ</title>
    <link rel="stylesheet" href="style.css"> 

    <link rel="manifest" href="manifest.json">
    
    <meta name="theme-color" content="#002145">
    
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    </head>
<body>
    <div class="container">
        <h1>โก๏ธ ูุชุฑุฌู ุฒููุณ</h1>
        <p>ุงุฎุชุฑ ุงูุฃุฏุงุฉ ุงูุชู ุชุฑูุฏ ุงุณุชุฎุฏุงููุง:</p>
        
        <div class="nav-buttons">
            <a href="translator.html" class="btn">
                <h2>ูุชุฑุฌู ูุตู</h2>
                <p>ูุชุฑุฌูุฉ ุงููุตูู ูุฅุฏุงุฑุฉ ููุงุชูุญ API.</p>
            </a>
            
            <a href="ูุญุฑุฑ.html" class="btn">
                <h2>ูุญุฑุฑ ูุตูู</h2>
                <p>ูุชุญุฑูุฑ ุงููุตูู ูุฅุฏุงุฑุฉ ุงููููุงุช ุงููุญููุธุฉ.</p>
            </a>
            
            <a href="glossary_editor.html" class="btn">
                <h2>๐ ูุญุฑุฑ ุงููุณุฑุฏ</h2>
                <p>ูุฅุฏุงุฑุฉ ุงููุตุทูุญุงุช ุงููุฏููุฉ ูุงููุณุชุฎุฑุฌุฉ.</p>
            </a>
            
            <a href="batch_translator.html" class="btn">
                <h2>ุงููุชุฑุฌู ุงูุฌูุงุนู</h2>
                <p>ูุชุฑุฌูุฉ ุงููุตูู ุงููุชุนุฏุฏุฉ.</p>
            </a>

            <a href="batch_extractor.html" class="btn">
                <h2>๐ ุงุณุชุฎุฑุงุฌ ุงููุตุทูุญุงุช ุงูุฌูุงุนู</h2>
                <p>ูุงุณุชุฎุฑุงุฌ ุงููุตุทูุญุงุช ูู ุงููุตูู ุงููุชุฑุฌูุฉ ูุณุจููุง.</p>
            </a>
            <a href="settings.html" class="btn">
                <h2>โ๏ธ ุงูุฅุนุฏุงุฏุงุช</h2>
                <p>ูุชุนุฏูู ุจุฑููุจุช ุงูุชุฑุฌูุฉ ูุงุณุชุฎุฑุงุฌ ุงููุตุทูุญุงุช.</p>
            </a>

            <a href="#" class="btn btn-backup" id="backupBtn">
                <h2>๐ค ุชุตุฏูุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ</h2>
                <p>ูุญูุธ ูู ุงููุตูู ูุงูุฅุนุฏุงุฏุงุช ูุงูููุงุชูุญ ูู ููู ZIP.</p>
            </a>

            <a href="#" class="btn btn-restore" id="restoreBtn">
                <h2>๐ฅ ุงุณุชุนุงุฏุฉ ูุณุฎุฉ</h2>
                <p>ูุงุณุชุนุงุฏุฉ ุจูุงูุงุชู ูู ููู ZIP (ุณูุชู ุญุฐู ุงูุจูุงูุงุช ุงูุญุงููุฉ).</p>
            </a>
            </div>
    </div>

    <div id="toast" class="toast"></div>
    
    <input type="file" id="restoreInput" accept=".zip" style="display: none;">

    <script src="config.js"></script>
    <script src="jszip.min.js"></script>
    
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('ServiceWorker registered: ', registration);
            })
            .catch(registrationError => {
              console.log('ServiceWorker registration failed: ', registrationError);
            });
        });
      }

      // ==== ๐ก (ุฅุถุงูุฉ) ููุฏ ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ ====

      // (ููุณูุฎุฉ ูู app.js)
      function showToast(message, type = 'success') {
          const toast = document.getElementById('toast');
          toast.textContent = message;
          toast.className = 'toast show';
          if (type === 'error') toast.classList.add('error');
          if (type === 'warning') toast.classList.add('warning');

          setTimeout(() => {
              toast.classList.remove('show');
              setTimeout(() => { toast.className = 'toast'; }, 500);
          }, 4000);
      }

      /**
       * ุฏุงูุฉ ุชุตุฏูุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงููุฉ
       */
      async function exportFullBackup() {
          if (typeof JSZip === 'undefined') {
              showToast('ุฎุทุฃ: ููุชุจุฉ (JSZip) ุบูุฑ ููุฌูุฏุฉ.', 'error');
              return;
          }
          
          showToast('ุฌุงุฑู ุชุญุถูุฑ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ...', 'warning');

          try {
              const zip = new JSZip();
              
              // 1. ุฌูุจ ูู ุงูููุงุชูุญ ูู CONFIG
              const keysToBackup = Object.values(CONFIG.STORAGE_KEYS);
              
              // 2. ุฅุถุงูุฉ ุงูููุงุชูุญ ุงูุฃุฎุฑู ูุฏููุงู (ุงูุชู ููุณุช ูู CONFIG)
              keysToBackup.push('zeusEditorConfig'); // ุฅุนุฏุงุฏุงุช ุงููุญุฑุฑ
              keysToBackup.push('zeus_translator_glossary_keys'); // ููุงุชูุญ ูุณุฑุฏ ุงูุชุฑุฌูุฉ ุงูุฌูุงุนูุฉ

              let filesAdded = 0;
              
              // 3. ุงููุฑูุฑ ุนูู ูู ุงูููุงุชูุญ ูุญูุธูุง ูู ุงูู ZIP
              for (const key of keysToBackup) {
                  const data = localStorage.getItem(key);
                  if (data) {
                      // ูุญูุธ ุงูููู ุจููุณ ุงุณู ุงูููุชุงุญ
                      zip.file(key + ".json", data);
                      filesAdded++;
                  }
              }

              if (filesAdded === 0) {
                  showToast('โ๏ธ ูุง ุชูุฌุฏ ุจูุงูุงุช ูุญูุธูุง!', 'warning');
                  return;
              }

              // 4. ุชูููุฏ ููู ุงูู ZIP
              const zipContent = await zip.generateAsync({ type: "blob" });
              
              // 5. ุฅูุดุงุก ุงุณู ููู ุจุงูุชุงุฑูุฎ
              const date = new Date();
              const dateString = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
              const fileName = `ZEUS_Backup_${dateString}.zip`;

              // 6. ุชูุนูู ุงูุชุญููู
              const link = document.createElement('a');
              link.href = URL.createObjectURL(zipContent);
              link.download = fileName;
              document.body.appendChild(link);
              link.click();
              
              setTimeout(() => {
                  document.body.removeChild(link);
                  URL.revokeObjectURL(link.href); 
              }, 100);
              
              showToast(`โ ุชู ุชุตุฏูุฑ ${filesAdded} ูููุงุช ุจูุงูุงุช ุจูุฌุงุญ!`, 'success');

          } catch (err) {
              console.error("ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ:", err);
              showToast('โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ููู ZIP.', 'error');
          }
      }

      /**
       * === ๐ก (ููุง ุงูุชุนุฏูู) ===
       * ุฏุงูุฉ ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ (ุชู ุชุนุฏูููุง)
       */
      function importFullBackup(event) {
          const file = event.target.files[0];
          if (!file) {
              // ูุฐุง ูุญุฏุซ ุฅุฐุง ูุชุญ ุงููุณุชุฎุฏู ูุงูุฐุฉ ุงููููุงุช ุซู ุฃุบูููุง
              // ุฃู ุจุณุจุจ ุฅุนุงุฏุฉ ุชุนููู ุงูุญูู ูู ุงูุฃุณููุ ูุง ุฏุงุนู ูุฅุธูุงุฑ ุฅุดุนุงุฑ ููุง
              return;
          }

          // --- ๐ก ุงูุฎุทูุฉ 1: ุทูุจ ุงูุชุฃููุฏ ุฃููุงู ---
          // ูุฐุง ุงูุขู ุฅุฌุฑุงุก ูุจุงุดุฑ ูุงุชุฌ ุนู "onchange"ุ ูุฐุง ูู ูุชู ุญุธุฑู
          if (!confirm("ุชุญุฐูุฑ: ุณูุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงูุญุงููุฉ (ุงููุตููุ ุงูุฅุนุฏุงุฏุงุชุ ุงูููุงุชูุญ) ูุงุณุชุจุฏุงููุง ุจุงูุจูุงูุงุช ูู ูุฐุง ุงูููู. ูู ุฃูุช ูุชุฃูุฏ ูู ุงููุชุงุจุนุฉุ")) {
              showToast('ุชู ุฅูุบุงุก ุนูููุฉ ุงูุงุณุชุนุงุฏุฉ.', 'warning');
              event.target.value = null; // ุฅุนุงุฏุฉ ุชุนููู ุงูุญูู ููุณูุงุญ ุจุงูุฑูุน ูุฑุฉ ุฃุฎุฑู
              return; // ุงูุฎุฑูุฌ ูู ุงูุฏุงูุฉ ุฅุฐุง ุถุบุท ุงููุณุชุฎุฏู "ุฅูุบุงุก"
          }

          // --- ุงูุฎุทูุฉ 2: ุงูุขู ูุจุฏุฃ ูุฑุงุกุฉ ุงูููู (ุจุนุฏ ุงูุญุตูู ุนูู ุงูููุงููุฉ) ---
          showToast('ุฌุงุฑู ูุฑุงุกุฉ ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ...', 'warning');
          
          const reader = new FileReader();
          reader.onload = async (e) => {
              try {
                  const content = e.target.result;
                  const zip = await JSZip.loadAsync(content);
                  
                  // ุชู ุฃุฎุฐ ุงูููุงููุฉ ูุณุจูุงูุ ูุจุฏุฃ ุงููุณุญ ูุงูุงุณุชุนุงุฏุฉ
                  localStorage.clear(); // ูุณุญ ูู ุดูุก
                  
                  let filesRestored = 0;

                  // ุงููุฑูุฑ ุนูู ูู ุงููููุงุช ูู ุงูู ZIP
                  for (const filename in zip.files) {
                      if (!zip.files[filename].dir) {
                          const key = filename.replace(".json", "");
                          const fileData = await zip.files[filename].async("string");
                          
                          // ุฅุนุงุฏุฉ ุงูุจูุงูุงุช ุฅูู localStorage
                          localStorage.setItem(key, fileData);
                          filesRestored++;
                      }
                  }
                  
                  showToast(`โ ุชู ุงุณุชุนุงุฏุฉ ${filesRestored} ููู ุจูุงูุงุช. ูุฑุฌู ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุงูุขู.`, 'success');
                  
                  // ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ูุชุทุจูู ุงูุฅุนุฏุงุฏุงุช
                  setTimeout(() => {
                      window.location.reload();
                  }, 4000);

              } catch (err) {
                  console.error("ุฎุทุฃ ุฃุซูุงุก ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ:", err);
                  showToast('โ ููู ZIP ุชุงูู ุฃู ุบูุฑ ุตุงูุญ.', 'error');
              } finally {
                  // ุฅุนุงุฏุฉ ุชุนููู ุญูู ุงูุฅุฏุฎุงู ููุณูุงุญ ุจุงูุฑูุน ูุฑุฉ ุฃุฎุฑู
                  event.target.value = null;
              }
          };
          
          reader.onerror = () => {
              showToast('โ ูุดู ูู ูุฑุงุกุฉ ุงูููู.', 'error');
              event.target.value = null;
          };
          
          reader.readAsArrayBuffer(file);
      }
      // === (ููุงูุฉ ุงูุชุนุฏูู) ===


      // --- ุฑุจุท ุงูุฃุญุฏุงุซ ููุฃุฒุฑุงุฑ ุงูุฌุฏูุฏุฉ ---
      document.addEventListener('DOMContentLoaded', () => {
          const backupBtn = document.getElementById('backupBtn');
          const restoreBtn = document.getElementById('restoreBtn');
          const restoreInput = document.getElementById('restoreInput');

          backupBtn.addEventListener('click', (e) => {
              e.preventDefault(); // ููุน ุงูุฑุงุจุท ูู ุงูููุฒ
              exportFullBackup();
          });

          restoreBtn.addEventListener('click', (e) => {
              e.preventDefault(); // ููุน ุงูุฑุงุจุท ูู ุงูููุฒ
              restoreInput.click(); // ูุชุญ ูุงูุฐุฉ ุงุฎุชูุงุฑ ุงูููู
          });

          restoreInput.addEventListener('change', importFullBackup);
      });
      // ===============================================

    </script>
    </body>
</html>